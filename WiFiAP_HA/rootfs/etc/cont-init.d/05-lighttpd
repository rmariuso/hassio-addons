#!/usr/bin/with-contenv bashio

# Runs the lighttpd 
bashio::log.info "lighttpd-enable-mod fastcgi-php   ..." 
lighttpd-enable-mod fastcgi-php    

bashio::log.info "Starting lighttpd ..." 

WEBROOT="/var/www/html"
CONFSRC="$WEBROOT/config/50-raspap-router.conf"
LTROOT=$(grep "server.document-root" /etc/lighttpd/lighttpd.conf | awk -F '=' '{print $2}' | tr -d " \"")

HTROOT=${WEBROOT/$LTROOT}
HTROOT=$(echo "$HTROOT" | sed -e 's/\/$//')
awk "{gsub(\"/REPLACE_ME\",\"$HTROOT\")}1" $CONFSRC > /tmp/50-raspap-router.conf
cp /tmp/50-raspap-router.conf /etc/lighttpd/conf-available/


exec lighttpd -f /etc/lighttpd/lighttpd.conf